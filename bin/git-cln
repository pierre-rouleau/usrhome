#!/bin/sh
# SH FILE: git-cln
#
# Purpose   : Git clone a specific branch.
# Created   : Thursday, January 29 2026.
# Author    : Pierre Rouleau <prouleau001@gmail.com>
# Time-stamp: <2026-01-29 10:28:24 EST, updated by Pierre Rouleau>
# ----------------------------------------------------------------------------

# Module Description
# ------------------
#
# The git-cln command implements a 'git clone' followed by a 'git co'
# to clone a Git repository and then check a specific branch out.
# The command takes and requires 2 arguments: the URL of the Git repo and the
# branch name.

# ----------------------------------------------------------------------------
# Dependencies
# ------------
#
#
# - git
# - printf

# ----------------------------------------------------------------------------
# Code
# ----
#
#
pgm_name="$(basename "$0")"

print_usage()
{
    printf -- "
%s:  Clone a Git repo and check out a specific branch.

 Usage:   %s REPO BRANCH

  • REPO:   the Git repository url.
  • BRANCH: the Git branch name.  One that is shown by 'git branch'.

The git clone is only done if the specified BRANCH exists in the
specified REPO.  The local directory created for the REPO is named
after the BRANCH.

" "$pgm_name" "$pgm_name"
}

# Check validity of arguments
if [ -z "$1" ]; then
    print_usage
    exit 1
fi
if [ "$1" == "--help" ] || [ "$1" == "-h" ]; then
    print_usage
    exit 0
fi
if [ -z "$2" ]; then
    print_usage
    exit 1
fi

# Check validity of branch in specified Git repo
if git ls-remote --heads "$1" 2> /dev/null | grep -E -e "/heads/$2\$"; then
    # -- Proceed
    if git clone "$1" "$2"; then
        cd "$2"
        git co "$2"
        printf -- "*** Success!  Execute 'cd %s' to use the new repo.\n" "$2"
    else
        printf -- "*** ERROR: git clone failed!\n"
        exit 1
    fi
else
    printf -- "*** ERROR: branch '%s' does not exist in Git repo '%s'\n" "$2" "$1"
    exit 2
fi

# ----------------------------------------------------------------------------
