#!/bin/sh
# SH FILE: pidcwd
#
# Purpose   : Print the current working directory of specified process ID.
# Created   : Sunday, September 21 2025.
# Author    : Pierre Rouleau <prouleau001@gmail.com>
# Time-stamp: <2025-09-21 16:05:28 EDT, updated by Pierre Rouleau>
# ----------------------------------------------------------------------------
# Module Description
# ------------------

# This script provides the same functionality of the pwdx that is available on
# linux but not available on macOS: it prints the current working directory of
# the specified process ID. The implementation uses pwdx if it is available,
# otherwise it uses lsof and AWK.


# ----------------------------------------------------------------------------
# Dependencies
# ------------
#
# - printf, lsof, awk
# - On Linux, it may use: pwdx

# ----------------------------------------------------------------------------
# Code
# ----
#
#
print_usage()
{
    printf -- "
pidcwd -- Print current working directory of specified process ID.

 Usage:

   - pidcwd -h | --help

     Print this help.

   - pidcwd PID

      Print the current working directory of PID.
"
}

# --
# validate arguments

if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
    print_usage
    # help requested explicitly: no error.
    return 0
fi

if [ -z "$1" ]; then
    print_usage
    return 1
fi

# --
# proceed

if lsof -p "$1" > /dev/null 2>&1; then
  if which pwdx > /dev/null 2>&1; then
      pwdx "$1"
  else
      lsof -a -d cwd -p "$1" -n -Fn | awk '/^n/ {print substr($0,2)}'
  fi
else
    printf -- "*** Error pidcwd: PID %s does not exists\n" "$1"
    exit 1
fi

# ----------------------------------------------------------------------------
