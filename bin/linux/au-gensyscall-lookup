#!/bin/sh
# SH FILE: au-gensyscall-lookup
#
# Purpose   : Generate syscall look-up table shell code.
# Created   : Sunday, November  3 2024.
# Author    : Pierre Rouleau <prouleau001@gmail.com>
# Time-stamp: <2024-11-03 17:14:55 EST, updated by Pierre Rouleau>
# ----------------------------------------------------------------------------
# Module Description
# ------------------
#
# This utility generates shell script code that declares a lookup table
# that maps a system call number to its function name.  The generated code
# is meant to be included inside a awk script  to transform the syscall
# number by the corresponding function name.

# ----------------------------------------------------------------------------
# Dependencies
# ------------
#
# - which, awk, printf

# ----------------------------------------------------------------------------
# Code
# ----
#
#

if which ausyscall > /dev/null; then
    # Proceed generating the code on stdout
    printf -- "\
# File generated by $USRHOME_DIR/bin/linux/au-gensyscall-lookup.
#
# Lookup-table of system call numbers to names.
# Created with 'ausyscall --dump'.
# This generated file is meant to be included inside a awk script.
#
"
    ausyscall --dump | while read -r line; do
        awk '\
 BEGIN { \
    print "BEGIN {" \
 } \
 /^[0-9]/ { \
    print "syscall[" $1 "]=\"" $2 "\"" \
 }
 END { \
   print "}"
 }' ; done
else
    printf -- "\
*** ERROR: %s/bin/linux/au-gensyscall-lookup:
    This utility requires ausyscall, a Linux audit utility.
    On this system ausyscall is not on PATH.
" "$USRHOME_DIR" 1>&2
    exit 1
fi

# ----------------------------------------------------------------------------
# Local Variables:
# sh-shell: /bin/sh
# End:
