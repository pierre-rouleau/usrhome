#!/bin/sh
# SH FILE: au-gensyscall-lookup
#
# Purpose   : Generate syscall look-up table shell code.
# Created   : Sunday, November  3 2024.
# Author    : Pierre Rouleau <prouleau001@gmail.com>
# Time-stamp: <2024-11-03 09:20:13 EST, updated by Pierre Rouleau>
# ----------------------------------------------------------------------------
# Module Description
# ------------------
#
# This utility generates shell script code that declares a lookup table
# that maps a system call number to its function name.  The generated code
# is meant to be sourced from other scripts that need to transform the syscall
# number by the corresponding function name.

# ----------------------------------------------------------------------------
# Dependencies
# ------------
#
# - which, awk, printf

# ----------------------------------------------------------------------------
# Code
# ----
#
#

if which ausyscall > /dev/null; then
    # Proceed generating the code on stdout
    ausyscall --dump | while read -r line; do
        awk '\
 BEGIN { \
    print "# File generated by $USRHOME_DIR/bin/linux/au-gensyscall-lookup." ; \
    print "# "; \
    print "# Lookup-table of system call numbers to names. "; \
    print "# Created with 'ausyscall --dump'."; \
    print "# This generated file is meant to be sourced by Bash scripts."; \
    print "#"; \
    print "declare -a syscall" \
 } \
 /^[0-9]/ { \
    print "syscall[" $1 "]=\"" $2 "\"" \
 }' ; done
else
    printf "\
*** ERROR: %s/bin/linux/au-gensyscall-lookup:
    This utility requires ausyscall, a Linux audit utility.
    On this system ausyscall is not on PATH.
" "$USRHOME_DIR" 1>&2
    exit 1
fi

# ----------------------------------------------------------------------------
# Local Variables:
# sh-shell: /bin/sh
# End:
