#!/bin/sh
# SH FILE: au-format
#
# Purpose   : Import format audit log records.
# Created   : Sunday, November  3 2024.
# Author    : Pierre Rouleau <pierre.rouleau@mitel.com>
# Time-stamp: <2024-11-03 17:58:03 EST, updated by Pierre Rouleau>
# ----------------------------------------------------------------------------
# Module Description
# ------------------
#
# Filter script: formats each line from stdin.
# The lines are expected to be audit log lines.


# ----------------------------------------------------------------------------
# Dependencies
# ------------
#
# - GNU awk
# - GNU sed

# ----------------------------------------------------------------------------
# Code
# ----
#
#
if [ ! -f /tmp/ausyscall-lookup.awk ]; then
    "$USRHOME_DIR/bin/linux/au-gensyscall-lookup" > /tmp/ausyscall-lookup.awk
fi
if [ ! -f /tmp/ausyscall-lookup.awk ]; then
    printf -- "\
*** ERROR: au-format: There is no /tmp/ausyscall-lookup.awk file!
           This file should have been generated by %s
" "$USRHOME_DIR/bin/linux/au-gensyscall-lookup" 1>&2
    exit 1
fi

# Execute the linup filter at the end: the other filters expect
# a log line format that has only 1 space separating first fields.

awk -f "$USRHOME_DIR/bin/other/au-log-syscall2name.awk" - \
| "$USRHOME_DIR/bin/linux/au-convert-date" \
| awk -f "$USRHOME_DIR/bin/other/au-log-lineup.awk"

# ----------------------------------------------------------------------------
# Local Variables:
# sh-shell: /bin/sh
# End:
